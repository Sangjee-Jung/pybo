{% extends 'base.html' %}
{% block content %}

<div class="container my-3">
    <h2 class="border-bottom py-2">
        <b>Financial Analysis (동종산업 Peer 비교)</b>
    </h2>
    <p></p>

    <div class="'input-group mb-3">
        <div class="card">
            <div class="card-header">
                <h5><i>Industry Analysis - Compare with your Peer Groups!</i></h5>
            </div>

            <div class="card-body">

                <ul class = "list-group list-group-flush">
                    <!-- #1. 산업조회: Target 회사가 속한 산업 내 Peer 조회 -->
                    <li class = "list-group-item">
                        <h5 class="card-title"><b>#1. 산업 조회</b></h5>
                        <h6 class="card-subtitle mb-2 text-muted">Target 회사가 속한 산업분류 내 Player 분석</h6>
                        <p></p>
                        <form id = "form_landscape_0" action = "{% url 'pybo:industry_landscape_1' %}" class="row g-3">
                            <div class="col-auto">
                                <input class="form-control" list="datalistOptions" name="target" id="target" placeholder="회사명을 입력하세요" required>
                                <datalist id="datalistOptions">
                                    {% for name in company_name_all %}
                                    <option> {{name}} </option>
                                    {% endfor %}
                                </datalist>
                            </div>
                            <div class="col-auto">
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type = "radio" name = "분류기준" id = "한국표준" value = "한국표준" required checked>
                                    <label class="form-check-label" for="한국표준">한국표준산업분류</label>
                                </div>
                            </div>
                            <div class="col-auto">
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type = "radio" name = "분류기준" id = "GICS" value = "GICS" disabled>
                                    <label class="form-check-label" for="GICS">GICS(글로벌산업분류기준)</label>
                                </div>
                            </div>
                            <div class="col-auto">
                                <input type="submit" class="btn btn-primary mb-3" value="제출">
                                {% csrf_token %}
                            </div>
                        </form>
                    </li>

                    <!-- #2. Peer Groups 지정: 직접 Peer 지정 -->
                    <li class = "list-group-item">
                        <h5 class="card-title"><b>#2. Peer Groups 지정</b></h5>
                        <h6 class="card-subtitle mb-2 text-muted">비교 대상 회사군 직접 선택하여 분석</h6>
                        <p></p>
                        <form id = "form_landscape_0_#2" action = "{% url 'pybo:industry_landscape_2_2' %}" class="row g-3">
                            <div class= "col-auto" id="inputList">
                                <input class="form-control" list="datalistOptions2" type="text" name="items[]" placeholder="회사명을 입력하세요">
                                <datalist id="datalistOptions2">
                                    {% for name in company_name_all %}
                                    <option> {{name}} </option>
                                    {% endfor %}
                                </datalist>
                            </div>

                            <div class="col-auto">
                                <button type="button" class="btn btn-secondary mb-3" onclick="addItem()">항목 추가</button>
                            </div>

                            <div class = "col-auto">
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type = "radio" name = "fs_type" id = "별도" value = "별도" checked="checked">
                                    <label class="form-check-label" for="별도">별도FS</label>
                                </div>
                            </div>

                            <div class = "col-auto">
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type = "radio" name = "fs_type" id = "연결" value = "연결">
                                    <label class="form-check-label" for="별도">연결FS</label>
                                </div>
                            </div>

                            <div class="col-auto">
                                <input type="submit" class="btn btn-primary mb-3" value="제출">
                            </div>
                            {% csrf_token %}
                        </form>
                        <p></p>

                        <!-- Container to display the list of inputs -->
                        <div id="displayList"></div>

                        <script>

                            // Helper function to check if the value exists in datalist
                            function valueExistsInDataList(inputElement) {
                                let dataListId = inputElement.getAttribute('list');
                                let options = document.querySelectorAll('#' + dataListId + ' option');
                                for(let option of options) {
                                    if(option.value === inputElement.value) {
                                        return true;
                                    }
                                }
                                return false;
                            }

                            function updateDisplayList() {
                                let displayList = document.getElementById('displayList');
                                displayList.innerHTML = "";  // Clear the current list
                                let inputs = document.querySelectorAll('#inputList input.form-control');
                                inputs.forEach(function(input, index) {
                                    let listItem = document.createElement('div');
                                    listItem.textContent = `Target ${index + 1}: ${input.value}`;
                                    displayList.appendChild(listItem);
                                });
                            }

                            function addItem() {
                                let inputList = document.getElementById('inputList');
                                let lastInput = inputList.querySelector('input.form-control:last-of-type');

                                // Check if the input value exists in the datalist before adding
                                if (lastInput && !valueExistsInDataList(lastInput)) {
                                    alert("회사명을 다시 확인하세요");
                                    return;
                                }

                                // Create the new input element
                                let newInput = document.createElement('input');
                                newInput.className = "form-control";
                                newInput.setAttribute('list', 'datalistOptions2');
                                newInput.type = "text";
                                newInput.name = "items[]";
                                newInput.placeholder = "회사명을 입력하세요";
                                inputList.appendChild(newInput);

                                // Create the associated datalist element
                                let dataList = document.createElement('datalist');
                                dataList.id = "datalistOptions2";
                                let companyNames = {# Assuming this is your list of company names in JS #} ['company1', 'company2']; // Adjust accordingly
                                companyNames.forEach(function(name) {
                                    let option = document.createElement('option');
                                    option.textContent = name;
                                    dataList.appendChild(option);
                                });
                                inputList.appendChild(dataList);


                                // Display the input value in the displayList container
                                newInput.addEventListener('input', updateDisplayList);

                                // Update the displayList initially for the newly created item
                                updateDisplayList();
                            }

                            // Adding event listener to the initial input
                            document.querySelector('#inputList input').addEventListener('input', updateDisplayList);

                            // Attach this validation to your "Add" button's click event
                            let addButton = document.getElementById('addButton');  // Assuming the id of your "Add" button is 'addButton'
                            addButton.addEventListener('click', addItem);

                        </script>

                    </li>

                </ul>
            </div>
        </div>

    </div>

{% load static %}
<script src="{% static '/script.js' %}"></script>


</div>
{% endblock %}